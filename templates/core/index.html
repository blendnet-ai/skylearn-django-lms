{% extends 'base.html' %}
{% load i18n %}
{% block title %}{{ title }} | {% trans 'Learning management system' %}{% endblock title %}
{% load static %}

{% block content %}

<div class="h-100">
    <div class="h-100">
        <!-- iframe embed -->
        <div class="h-100">
            <iframe id="testIframe" class="embed-responsive-item" src="{{ path }}" width="100%" height="100%"></iframe>
        </div>
    </div>
</div>
{% endblock content %}

{% block js %}
<script>
    const url = window.location.href;
    const newUrl = url.split('sakshm/')[0]
    const currentUrl = new URL(window.location.href);

    console.log(
        {
            url,
            newUrl,
        }
    );

    window.addEventListener('message', (event) => {
        if (event.data && event.data.type === 'ROUTE_CHANGE') {
            const newRoute = event.data.route;
            const newQueryParams = event.data.queryParams;
            console.log(newQueryParams);

            const currentUrl = new URL(window.location.href);
            currentUrl.pathname = currentUrl.pathname.split('sakshm/')[0] + "sakshm" + newRoute
            currentUrl.search = newQueryParams;

            console.log("Final URL: ", currentUrl.toString());
            window.history.pushState({}, '', currentUrl);
        }
        if (event.data && event.data.type === 'ROUTE_HOME') {
            console.log("ROUTE_HOME", event.data);
            const currentUrl = new URL(window.location.href);
            currentUrl.pathname = currentUrl.pathname.split('sakshm/')[0] + event.data.route

            console.log("Final URL: ", currentUrl.toString());
            window.location.href = currentUrl;
        }
    });


</script>
{% endblock %}